<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello React!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.2/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.2/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.js"></script>
<style>
body {margin:auto;max-width:600px}
</style>
  </head>
  <body>
    <div id="example"></div>
    <script type="text/babel">
var Input = React.createClass({
  getInitialState: function() {
    return {value: 0};
  },
   play_words: function(event) {
    speak(test_data[this.state.value]);
    
  },
  handleChange: function(event) {
    this.setState({value: this.state.value+1});
    current_phase=test_cards[event.target.value];
  },
  render: function () {
    var value = this.state.value;
    return (
      <div>
        <div><a onClick=play_words)>PLAY:</a>{test_cards[value]}</div>
        <div><a onClick=handleChange)>NEXT:</a></div>
        <p id="card1">{value}</p>
      </div>
    );
  }
});

ReactDOM.render(<Input/>, 
        document.getElementById('container')
      );
var respond = function(event) {
	var text = '';
	for (var i = event.resultIndex; i < event.results.length; ++i) {
		var result = event.results[i];
		text = result[0].transcript;
		text= text.trim();
		if (result.isFinal) {
			output.innerHTML = text+":"+current_phase;
             console.log(text);
			output.style.color = 'black';
			output = createOutput();
			if (current_phase.toLowerCase()==text) { speak("OK"); }
			else { speak("sorry"); }
		} else {
			output.innerHTML = text;
		}
	}
}
var createOutput = function() {
	var output = document.createElement('div');
	output.style.color = 'gray';
	document.getElementById('card1').appendChild(output);
	return output;
}
var speak = function(text) {
	// chrome://flags -> Enable experimental Web Platform features
	var utterance = new SpeechSynthesisUtterance(text);
	utterance.lang = 'en-US';
	utterance.volume = 1; // 0 to 1
	utterance.rate = 1; // 0.1 to 10
	utterance.pitch = 1; //0 to 2
	window.speechSynthesis.speak(utterance);
}
var listen = function() {
	var recognition = new webkitSpeechRecognition();
	recognition.continuous = true;
	recognition.interimResults = true;
	recognition.lang = 'en-US';
	recognition.start();
	recognition.onresult = respond;
	//recognition.onend = function(event) { console.log(event) };
}
var display_card = function (number){
  
}
var output = createOutput();
var current_phase="";
var test_cards = [{phrase="Hello"},
  {phrase="Goodbye"},
  {phrase="good morning"},
  {phrase="My name is Peter"},
  ];

    </script>
  </body>
</html>
