<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello React!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.2/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.2/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.js"></script>
<style>
body {margin:auto;max-width:600px}
</style>
  </head>
  <body>
    <div id="example"></div>
    <script type="text/babel">
var current_phase="";
var test_cards = [{phrase:"Hello"},
  {phrase:"Goodbye"},
  {phrase:"good morning"},
  {phrase:"My name is Peter"},
  ];
var CardP = React.createClass({
  getInitialState: function() {
  	var recognition = new webkitSpeechRecognition();
	recognition.continuous = true;
	recognition.interimResults = true;
	recognition.lang = 'en-US';
	recognition.start();
	recognition.onresult = this.VoiceResponse;
	console.log("listen") ;
    return {value: 0, recognition: recognition};
  },
   playWords: function(event) {
    speak(test_cards[this.state.value].phrase);
    console.log("playWords:"+test_cards[this.state.value].phrase);
    
  },
  handleChange: function(event) {
    this.setState({value: this.state.value+1});
    current_phase=test_cards[event.target.value];
  },
  matchWords: function(event) {
    console.log("matchWords:"+test_cards[this.state.value].phrase);
    var re= this.state.recognition;
    re.start();
  },  
    VoiceResponse: function(event) {
    console.log("VoiceResponse:"+test_cards[this.state.value].phrase);
    var text = '';
	for (var i = event.resultIndex; i < event.results.length; ++i) {
		var result = event.results[i];
		text = result[0].transcript;
		text= text.trim();
		if (result.isFinal) {
             	console.log(text);
			if (test_cards[this.state.value].phrase.toLowerCase()==text.toLowerCase()) { speak("OK"); }
			else { speak("sorry"); }
		} else {
			//output.innerHTML = text;
		}
	}
  },
  render: function () {
    var value = this.state.value;
    return (
      <div>
        <div><a href="#" onClick={this.playWords}>PLAY:</a>{test_cards[value].phrase}</div>
        <div><a href="#" onClick={this.matchWords}>LISTEN:</a></div>
        <div><a href="#" onClick={this.handleChange}>NEXT:</a></div>
        <p id="card1">{value}</p>
      </div>
    );
  }
});

ReactDOM.render(<CardP/>, 
        document.getElementById('example')
      );


var speak = function(text) {
	// chrome://flags -> Enable experimental Web Platform features
	var utterance = new SpeechSynthesisUtterance(text);
	utterance.lang = 'en-US';
	utterance.volume = 1; // 0 to 1
	utterance.rate = 1; // 0.1 to 10
	utterance.pitch = 1; //0 to 2
	window.speechSynthesis.speak(utterance);
}
var listen = function() {
	var recognition = new webkitSpeechRecognition();
	recognition.continuous = true;
	recognition.interimResults = true;
	recognition.lang = 'en-US';
	recognition.start();
	recognition.onresult = respond;
	console.log("listen") ;
}

    </script>
  </body>
</html>
